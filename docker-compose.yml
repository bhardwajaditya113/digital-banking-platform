services:
  # API Gateway (Kong)
  api-gateway:
    build:
      context: ./infrastructure/docker/kong
      dockerfile: Dockerfile
    container_name: banking-api-gateway
    ports:
      - "8000:8000"
      - "8443:8443"
      - "8001:8001"
    environment:
      KONG_DATABASE: "off"
      KONG_DECLARATIVE_CONFIG: /kong/declarative/kong.yml
      KONG_PROXY_ACCESS_LOG: /dev/stdout
      KONG_ADMIN_ACCESS_LOG: /dev/stdout
      KONG_PROXY_ERROR_LOG: /dev/stderr
      KONG_ADMIN_ERROR_LOG: /dev/stderr
      KONG_ADMIN_LISTEN: 0.0.0.0:8001
    volumes:
      - ./infrastructure/docker/kong/kong.yml:/kong/declarative/kong.yml
    networks:
      - banking-network
    depends_on:
      - auth-service
      - account-service
      - transaction-service

  # Auth Service
  auth-service:
    build:
      context: ./src/backend
      dockerfile: services/AuthService/AuthService.API/Dockerfile
    container_name: banking-auth-service
    ports:
      - "5001:8080"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__DefaultConnection=Server=banking-sqlserver;Database=BankingAuth;User Id=sa;Password=Banking@123!;TrustServerCertificate=True;
      - JwtSettings__SecretKey=YourSuperSecretKeyForJWTTokenGeneration123456789
      - JwtSettings__Issuer=BankingPlatform
      - JwtSettings__Audience=BankingPlatform
      - KafkaSettings__BootstrapServers=banking-kafka:29092
    networks:
      - banking-network

  # Account Service
  account-service:
    build:
      context: ./src/backend
      dockerfile: services/AccountService/AccountService.API/Dockerfile
    container_name: banking-account-service
    ports:
      - "5002:8080"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__DefaultConnection=Server=banking-sqlserver;Database=BankingAccounts;User Id=sa;Password=Banking@123!;TrustServerCertificate=True;
      - ConnectionStrings__MongoDB=mongodb://banking_admin:Banking@123!@banking-mongodb:27017/banking_documents?authSource=admin
      - KafkaSettings__BootstrapServers=banking-kafka:29092
    networks:
      - banking-network

  # Transaction Service
  transaction-service:
    build:
      context: ./src/backend
      dockerfile: services/TransactionService/TransactionService.API/Dockerfile
    container_name: banking-transaction-service
    ports:
      - "5003:8080"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__DefaultConnection=Server=banking-sqlserver;Database=BankingTransactions;User Id=sa;Password=Banking@123!;TrustServerCertificate=True;
      - ConnectionStrings__MongoDB=mongodb://banking_admin:Banking@123!@banking-mongodb:27017/banking_documents?authSource=admin
      - KafkaSettings__BootstrapServers=banking-kafka:29092
    networks:
      - banking-network

  # Notification Service
  notification-service:
    build:
      context: ./src/backend
      dockerfile: services/NotificationService/NotificationService.API/Dockerfile
    container_name: banking-notification-service
    ports:
      - "5004:8080"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__MongoDB=mongodb://banking_admin:Banking@123!@banking-mongodb:27017/banking_documents?authSource=admin
      - KafkaSettings__BootstrapServers=banking-kafka:29092
    networks:
      - banking-network

  # Investment Service
  investment-service:
    build:
      context: ./src/backend
      dockerfile: services/InvestmentService/InvestmentService.API/Dockerfile
    container_name: banking-investment-service
    ports:
      - "5005:8080"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__DefaultConnection=Server=banking-sqlserver;Database=BankingInvestments;User Id=sa;Password=Banking@123!;TrustServerCertificate=True;
      - KafkaSettings__BootstrapServers=banking-kafka:29092
    networks:
      - banking-network

  # Loan Service
  loan-service:
    build:
      context: ./src/backend
      dockerfile: services/LoanService/LoanService.API/Dockerfile
    container_name: banking-loan-service
    ports:
      - "5006:8080"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__DefaultConnection=Server=banking-sqlserver;Database=BankingLoans;User Id=sa;Password=Banking@123!;TrustServerCertificate=True;
      - KafkaSettings__BootstrapServers=banking-kafka:29092
    networks:
      - banking-network

networks:
  banking-network:
    external: true
